//: [Previous](@previous)

import Foundation

var input = """
                                                                                         |
   +-------+                                         +-+ +-------------------------------------------------------------------------+   +-+   +-----------------------------------------+   +-+   +---+
   |       |                                         | | |                               |                                         |   | |   |                                         |   | |   |   |
   |       |                                         | +-|---------------+       +---------+   +---------------------------------------|---------------------------+                   |   | |   |   |
   |       |                                         |   |               |       |       | |   |                                   |   | |   |                     |                   |   | |   |   |
   |       |                                         |   +-------------------------------|-----------------------------------------|---|-|---|---------------------|-----------------+ |   | |   |   |
   |       |                                         |                   |       |       | |   |                                   |   | |   |                     |                 | |   | |   |   |
   |       |                                   +-------+   +-----------+ |       +-----+ | |   |                 +---------------+ |   | |   |     +---------------+       +---------+ |   | |   |   |
   |       |                                   |     | |   |           | |             | | |   |                 |               | |   | |   |     |                       |           |   | |   |   |
   |   +---------------------------------------------|-----------------|-|-----+       | | |   |                 +---------------|-|---------------|-------------------+   |           |   | |   |   |
   |   |   |                                   |     | |   |           | |     |       | | |   |                                 | |   | |   |     |                   |   |           |   | |   |   |
   +-------|-----+                             |     | |   |     +---------------------|---|---|-----------------------------------|-+ | |   |     |                   |   |           |   | |   |   |
       |   |     |                             |     | |   |     |     | |     |       | | |   |                                 | | | | |   |     |                   |   |           |   | |   |   |
   +-+ |   +-----------------------------------------------------|-----|-|-------------|-|-|---|---------------------------------|-|-|-|-|---|-----|-------------------|---|-----+     |   | |   | +---+
   | | |         |                             |     | |   |     |     | |     |       | | |   |                                 | | | | |   |     |                   |   |     |     |   | |   | | | |
   | | |         |     +-----------------------|-----|-----------|-----|-|-----|---------|---------------------------+       +---+ +-|-|-----------|-----------+ +-----+   |     |     |   | |   +-|-|-+
   | | |         |     |                       |     | |   |     |     | |     |       | | |   |                     |       |       | | |   |     |           | |         |     |     |   | |     | |
   | | +---------|-----------------------------------|-----|-----|-----|-----------------|-|-------------------------|-------|---------|-|-+ |     | +-----+   | |         |     |     |   | |     | |
   | |           |     |                       |     | |   |     |     | |     |       | | |   |                     |       |       | | | | |     | |     |   | |         |     |     |   | |     | |
   | |           |     |   +-------+           |     | |   |     +-----------------------|-----|-+                   |       |       | | | | |     | |     |   | |         |     |     |   | | +---+ |
   | |           |     |   |       |           |     | |   |           | |     |       | | |   | |                   |       |       | | | | |     | |     |   | |         |     |     |   | | |     |
   | |           |     |   |       |           |     | |   |           | |     |       | | |   | |                   |       |       | | | | |     | |     |   | |         |     |     |   | | |     |
   | |           |     |   |       |           |     | |   |           | |     |       | | |   | |                   |       |       | | | | |     | |     |   | |         |     |     |   | | |     |
   | |           |     |   |       |           |     | |   | +-----------|-----|-----------|---|-+                   |       |     +---|-------------|---------|-----------------------|---|---|-------+
   | |           |     |   |       |           |     | |   | |         | |     |       | | |   |                     |       |     | | | | | |     | |     |   | |         |     |     |   | | |     | |
   | |           |     |   |       |           |     | |   | |         | |     |       +-|-----------------------------------------|-+ | | | |     | +-----|---|-----+     |     |     |   | | |     | |
   | |           |     |   |       |           |     | |   | |         | |     |         | |   |                     |       |     |   | | | |     |       |   | |   |     |     |     |   | | |     | |
   | |       +---------|-----------|-----------|-----|-----|-----------|---------------+ | |   |                     |       |     | +---|-|---------------|---|-|---+     |     +---+ |   | | |     | |
   | |       |   |     |   |       |           |     | |   | |         | |     |       | | |   |                     |       |     | | | | | |     |       |   | |         |         | |   | | |     | |
   | |       |   | +---|-------+   +-----------------|-----|-|---------+ |     |       | | |   |                     |       |     | | | | | |   +-------------|-|---------+         | |   | | |     | |
   | |       |   | |   |   |   |               |     | |   | |           |     |       | | |   |                     |       |     | | | | | |   | |       |   | |                   | |   | | |     | |
   | |       |   | |   |   |   |               |     | |   | |           |     |       | | |   |                     |       |     | | | | | |   | +---+ +-------|-+                 | |   | | |     | |
   | |       |   | |   |   |   |               |     | |   | |           |     |       | | |   |                     |       |     | | | | | |   |     | | |   | | |                 | |   | | |     | |
   | |       |   | |   |   |   |               |     | |   | |         +-------|-------|-|-|-------------+           |       |     | | | | | | +-|-+   | | |   | | +-+ +-------+   +-------|---|---+ | |
   | |       |   | |   |   |   |               |     | |   | |         | |     |       | | |   |         |           |       |     | | | | | | | | |   | | |   | |   | |       |   | | |   | | |   | | |
   | |       |   | |   |   |   |               |     | |   | |         | |     +-----+ | +---------------|-------------------|-----------|---|-|-|-|-------|---|---+ +---------------+ |   | | |   | | |
   | |       |   | |   |   |   |               |     | |   | |         | |           | |   |   |         |           |       |     | | | | | | | | |   | | |   | | |   |       |   |   |   | | |   | | |
   | |       | +-|-----|-------------------+   |     | |   | |         | |           | |   |   |         |   +-------|-------------|---|-|-|---+ | |   | | |   | | |   |       +-----------|---|-+ | | |
   | |       | | | |   |   |   |           |   |     | |   | |         | |           | |   |   |         |   |       |       |     | | | | | |   | |   | | |   | | |   |           |   |   | | | | | | |
   | |       | | | |   | +---------------------+     | |   | |       +-+ |         +-------|---|-----------------+   |       |     | | | | | |   | |   | | |   | | |   |           |   |   | | | | | | |
   | |       | | | |   | | |   |           |         | |   | |       |   |         | | |   |   |         |   |   |   |       |     | | | | | |   | |   | | |   | | |   |           |   |   | | | | | | |
   | |       | | | |   | | |   |     +-----|------L--|-------------------|-------------|---|---------------------|---|-------|---+ | | | | | | +-------|-+ |   | | |   |       +-----------+ | | | | | |
   | |       | | | |   | | |   |     |     |         | |   | |       |   |         | | |   |   |         |   |   |   |       |   | | | | | | | | | |   |   |   | | |   |       |   |   |     | | | | | |
   | |   +---------------------------------|-----------|---|-----------------------|-------|---|---------|---|---------------|---------|-|---|---|-------------|-|-|---+       |   |   |     | | | | | |
   | |   |   | | | |   | | |   |     |     |         | |   | |       |   |         | | |   |   |         |   |   |   |       |   | | | | | | | | | |   |   |   | | |           |   |   |     | | | | | |
   | |   |   | | +-------+ +---|-----|-----|-----------------|-----------+     +---------------|-------------|---------------|-----|-------|---|-+ |   |   |   | | |           |   +-+ |     | | +-+ | |
   | |   |   | |   |   |       |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |     | |
   | |   +---|-----|---|---+   |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |     | |
   | |       | |   |   |   |   |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |     | |
   | |       | +---+ +---+ | +-|-----|-----|---------------|-|-------------------------|---|---------------------------------|-----|-|-----|-|-|---|-------|-------|-----------|-----|---------------+ |
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |       |
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | |   +---|---------|-------|---|-+     |   | | | | | | | |   |   |   |   | | | +-+       |   +---|-----|-+       |
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | |       |         |   |   |   | |     |   | | | | | | | |   |   |   |   | | | | |       |   | | |     |         |
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | +-------------------------|---|-|---------|-|---|-|-|-|-|-----------|---|---|---|-------|---|-|-|-----|-+       |
   | |       |       | | | | | |     |     |         | |   | |       |         |   | |         |         |   |   |   | |     |   | | | | | | | |   |   |   |   | | | | |       |   | | |     | |       |
   | |       +-+     | | | | | |     |     |         | +-----+       |         |   | |         |         +-------------|-----|-----|-|-------|-----|-----------|-+ | | |       |   | | |     | |       |
   | |         |     | | | | | |     |     |         |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |   |   |   | | |       |   | | |     | |       |
   | |         |     | | | | | |     |     |         |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |   +---|---|---|-----------+ | |     | |       |
   | |         |     | | | | | |     |     |         |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |       |   | | |       |     | |     | |       |
   | |         |     | | | | | |   +-|-----+   +-----|-----|-------------------|-----------------------------|-------|-|-----|---|---|---|-------------|-------|---|-|---------|-+   | |     | | +-+   |
   | |         |     | | | | | |   | |         |     |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |       |   | | |       | |   | |     | | | |   |
   | |         |     | | | | | |   | |         |     |     |         |         |   | |   +-------------------|---------------------|---|---|-|-|-------|-------|-----|---------|-----|-----------+ |   |
   | |         |     | | | | | |   | |         |     |     |         |         |   | |   |     |             |   |   | |     |   | | | | | | | |   |   |       |   | | |       | |   | |     | |   |   |
 +---|---------------|---|-|-|-|---|-|---------|-----|---------------|---------|---------|-------------------|---|-----|-------+ | | | | | | | |   |   |       | +-|-|-----+   | |   | |     | |   |   |
 | | |         |     | | | | | |   | |         |     |     |         |         |   | |   |     |             |   |   | |     | | | | | | | | | |   |   |       | | | | |   |   | |   | |     | |   |   |
 | | |         |     | | | | | |   | |         |     |     |         |   +-----|---------------|-----------------|---|-|-------|-|---|-+ | | +-----|-----+     | | | | |   |   | |   | |     | |   |   |
 | | |         |     | | | | | |   | |         |     |     |         |   |     |   | |   |     |             |   |   | |     | | | | |   | |   |   |   | |     | | | | |   |   | |   | |     | |   |   |
 | | |         |     | | | | | |   | |     +---------|-----|-------------|-----|---------|-----|-----------------|---|---------|-----|---------|---|-----------|-+ | | |   |   | |   | |     | |   +-+ |
 | | |         |     | | | | | |   | |     |   |     |     |         |   |     |   | |   |     |             |   |   | |     | | | | |   | |   |   |   | |     |   | | |   |   | |   | |     | |     | |
 | | |         |     | | | | | |   | |     |   |     |     |     +-----------------------|-------------------|---|---|-|-------|-------------------|-----|-------------|-------+ |   | |   +-----+   | |
 | | |         |     | | | | | |   | |     |   |     |     |     |   |   |     |   | |   |     K             |   |   | |     | | | | |   | |   |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | +-------+ | | | +---|---------|-----------|-------------------------|--W--------------------|-------|-|-----|-|-|-|-----|-|-+ |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | |   | |   | | | | | |     |   |     |     |     |   |   |     |   | |   |     |             |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | |   | |   | | | | | |     |   |     | +---|-----|---|---------|---|-|---|---------------+   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | |   | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | |   | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | |   | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | |
 | | |         | |   | |   +-|-|---|-|---------|-----|-----------|---|-------------|-|---|-----|-----------------|---|-|-------------------|-|-------+ | |     |   | +-|---|-----|---|-|---|---|---+ | |
 | | |         | |   | |     | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   | | | |     |   |   |   |     |   | |   | | | | | | |
 | | |         +-+   | |   +-|---|---------|---------|-|---|-----|---|---|-----|---------|-----|-----------------------|-------|---|-|---|-|-|-|-----|---|-----|-------|---+     |   | |   | | | | | | |
 | | |               | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   | | | |     |   |   |         |   | |   | | | | | | |
 | | |               | | +---|---|-------------------------|-----|---|---------|-------------------------+   |   |   | |     | | | | |   | | | +-----|-|-|-----|-------|-----+   |   | |   | | | | | | |
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |             |   |   | |     | | | | |   | | |     | | | |     |   |   |     |   |   | |   | | | | | | |
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   | |   |     | +-----------|-----------------|-|-|-|-+ | | |     | | | |     |   |   |     |   |   | |   | | | | | | |
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   | |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |   |   |     |   |   | |   | | | | | | |
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   +-----+     | |           |   |   | |     | | | | | | | | |     | | | |     |   |   |     |   |   | |   | | | | | | |
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |     |         | |           |   |   | |     | | | | | | | | |     | | | |     |   |   |     |   |   | |   | | | | | | |
 | | |           +---|-|---|---------------|---------|-|---|-----|---|---|-----|-----|---+     | |           |   |   | |     | | | | | | | | |     | | | |     |   +---------------+ | |   | | | | | | |
 | | |           |   | | | | | | | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | |
 | | |           |   +-------|-+ | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | |
 | | |           |     | | | |   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | |
 | | |     +-----------|-|-|-----|---------|---|---------------------|---|-----------|---|-------|-------------------|-+     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | |
 | | |     |     |     | | | |   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | |
 | | |     |   +-|-----|-|-|---------|---------------|-----|-----|---|---------|-----|---|-------|-------------------|-----------|-----|-|---|-----|---|-|-----|-------|---------+ | | |   | | | | +-+ |
 | | |     |   | |     | | | |   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     |
 | | +---------|---------|---+   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     |
 | |       |   | |     | | |     | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     |
 | | +-----|---|-+   +-|---+     | | |     |   |     | |   |     +-------|---------------------|-|-------+   |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     |
 | | |     |   |     | | |       | | |     |   |     | |   |         |   |     |     |   |     | |       |   |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     |
 | | |     |   |     +-|-----+   | | |     |   |     | |   |         |   |     |     |   |     | |       |   |   |   |       | +-|-|-+ | +---------|---|---+   |       |     |     | | |   | | | |     |
 | | |     |   |       | |   |   | | |     |   |     | |   |         |   |     |     |   |     | |       |   |   |   |       |   | |   |   | |     | | | | |   |       |     |     | | |   | | | |     |
 | | +-----------------|-|-------|-+ |     |   |     | |   |         |   |     |     |   |     | |       | +-|-------|-----------|---------|-|---------|---+   |       |     |     | | |   | | | |     |
 | |       |   |       | |   |   |   |     |   |     | |   |         |   |     |     |   |     | |       | | |   |   |       |   | |   |   | |     | | | |     |       |     |     | | |   | | | |     |
 | |       |   |       | |   |   |   |     |   |     | |   |         |   |     +-----|---|---------------------------|-------------+   |   | |     | | | |     |       |     |     | | |   | | | |     |
 | |       |   |       | |   |   |   |     |   |     | |   |         |   |           |   |     | |       | | |   |   |       |   |     |   | |     | | | |     |       |     |     | | |   | | | |     |
 | | +-----|---|-------|-|---|-------|---------|-----|-|---|-------------|-----------------------------------|---------------|---------|-------------+ | |     |       |     |     | | |   | | | |     |
 | | |     |   |       | |   |   |   |     |   |     | |   |         R   |           |   |     | |       | | |   |   |       |   |     |   | |     |   | |     |       |     |     | | |   | | | |     |
 | | |     |   |     +-|-|-------|---------|---|-------|---------------------------------------|-|-------|-|-|---------------|---|---------|-|-----|---|---------------|-+   |     | | |   | | | |     |
 | | |     |   |     | | |   |   |   |     |   |     | |   |         |   |           |   |     | |       | | |   |   |       |   |     |   | |     |   | |     |       | |   |     | | |   | | | |     |
 | | |     |   |     +-|-|---|-------------|---|-------|-------------+   |           |   |   +-|-|-------|-|-|---|---------------------|---+ |     |   | |     |       | |   |     | | |   | | | | +-+ |
 | | |     |   |       | |   |   |   |     |   |     | |   |             |           |   |   | | |       | | |   |   |       |   |     |     |     |   | |     |       | |   |     | | |   | | | | | | |
 | +-|-----|-------------------------------|---|-----|-|---------------------------------|---+ | | +-----|-|-|---|---|-----------------|-----------+   | |     |       | |   |     | | |   | | | | | | |
 |   |     |   |       | |   |   |   |     |   |     | |   |             |           |   |     | | |     | | |   |   |       |   |     |     |         | |     |       | |   |     | | |   | | | | | | |
 |   |     |   | +-----------|---|---|-----|-----------|---|-------------|-----------|---|-----+ | +-------|-|---|---|---------------------------------|-------|-----+ | | +---+   | | |   | | | | | | |
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |       |       | | |   |   |       |   |     |     |         | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   +-------------------------------|---|---------------+ +-+ | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   |   |       | | |   |   |       |   |     |     |   | | | | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   |   |       | | |   |   |       |   |     |     | +---|-+ | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   |   | +-----------------|-|---|-------------+ +-+       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   |   | | |     |   |     | |   |               | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |   +-----|-----------|-----|-----------+         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | |
 |   |     |   | |     | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | |
 | +-|-----|---------+ | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | +-+ | | | | | |
 | | |     |   | |   | | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | |   | | | | | |
 | | |     |   | |   | | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | |   | | | | | |
 | | |     |   | |   | | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | |   | | | | | |
 +---|-----|-----|-----|-|-------+ | |     |   |     | |   |   +-|---------|-|-----------|-------|-------|-------|---|-------|---|-----|---------|-----|-+     | +-+ | | +-+ | |   | | | |   +-|-+ | | |
   | |     |   | |   | | |         | |     |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | |     | |   | | | |     |   | | |
 +---|-----|-----+   | | |         | | +---|---|-------|---|-----|---------|-|---------------|---|-------|-|-|---|---------------|-----|-----|-|-------|-------|---|-----+   | |   | | | |     |   | | |
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | | |
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | | |
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | | |
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | +-+
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   |
 | | |     |   |     | | |         | | |   |   |     | |   |   +-|---------|-------+ |   | +-|---|-------|-------|-----------|---------|-----+ | | |   |       | | | | | |   | |   | | | |     | +-|---+
 | | |     |   |     | | |         | | |   |   |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |       | | |   |       | | | | | |   | |   | | | |     | | |   |
 | | |     |   |     | | |         | | |   |   |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |       +-|-|-------+   | | | | | +---------|-----|-----|-+ |   |
 | | |     |   |     | | |         | | |   |   |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | |     | |   | | | |     |   |   |
 | | |     |   |     | | |         | | |   | +---------|---------|---------|--Q------|-------------------|-----------------------------|---------|-----|---|---|---|-|---+   | |   | | | |     |   |   |
 | | |     |   |     | | |         | | |   | | |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | | |   | |   | | | |     |   |   |
 | | |     |   |   +-|-----------------|-----|-|-----------------|---------+ |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | | |   | |   | | | |     |   |   |
 | | |     |   |   | | | |         | | |   | | |     | |   |     |           |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | | |   | |   | | | |     |   |   |
 | | |     |   |   | | | |         +---|---|-|-+     | |   |     |           |     +-----|-|-|-+ |       | | |   |   |       |   |     |         | |   +---|-------|---+ |   | |   | | | |     |   |   |
 | | |     |   |   | | | |           | |   | |       | |   |     |           |       |   | | | | |       | | |   |   |       |   |     |         | |       |   | | | |   |   | |   | | | |     |   |   |
 | | |     +-----------|-|-----------|-|-+ | |       | +---|-----|-----------|-------|-------------------|-------------------|---------|-------------------|---|-|-------+   | |   +-|-+ |     |   |   |
 | | |         |   | | | |           | | | | |       |     |     |           |       |   | | | | |       | | |   |   |       |   |     |         | |       |   | | | |       | |     |   |     |   |   |
 | | |         |   | | | |           | | +-----------------|-----|-----------------------|-|-----+       +----I--|-----------|-----------------------------|-----|-+ |       | |     |   |     |   |   |
 | | |         |   | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |   |       |   |     |         | |       |   | |   |       | |     |   |     |   |   |
 | | |         |   | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |   |       |   |   +-|-----------|---------------+ |       | |     |   |     |   |   |
 | | |         |   | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |   |       |   |   | |         | |       |   | | | |       | |     |   |     |   |   |
 | | | +-+     | +---|---|-----------|-----|-|-------------|-----|-----------|---------------|-------------|---------+       |   |   | |         | |       |   | | | |       | |     |   |     |   |   |
 | | | | |     | | | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |           |   |   | |         | |       |   | | | |       | |     |   |     |   |   |
 | | | | |     | | | | +-|-----------|-|---|-|-------------|-------------------------|---|-|-|-|---------+ | |   |           |   |   | |         | +-------|---|-|---|-------|-|---+ |   |     |   |   |
 | | | | |     | | | |   |           | |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | |         |         |   | | | |       | |   | |   |     |   |   |
 | | | | |     | | | |   |       +---+ |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | |         |         | +-----+ |       | |   +-|-----------------+
 | | | | |     | | | |   |       |     |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | |         |         | | | |   |       | |     |   |     |   |
 | | | | |     +-+ +-------------|---+ |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | +---------------------+ | |   |       | |   +-----+     |   |
 | | | | |           |   |       |   | |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   | +-+ | |       |     |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   | | |       |     |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   | +---------|---+ |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |
 | | | | | +---------|---|-------|-----------|-----------|-|-----|-----------|-------+   | | | |   +-------|-----|-----------|-------|-----------|---------|-----|---+       | |   | |         |   |
 | | | | | |         |   |       |   |   |   |       |   | |     |           |           | | | |   |     | | |   |           |   |   |           |         |   | |           | |   | |         |   |
 | | | | | | +-------+   |       |   |   |   |       |   | |     +-----------|-----------|-----|---|-----|-|-----|-----+     +---|---------------|---------+   +-------------|-----+ |         |   |
 | | | | | | |           |       |   |   |   |       |   | |                 |           | | | |   |     | | |   |     |         |   |           |               |           | |     |         |   |
 | | | | | | |           |       +-+ |   |   |       |   | |                 |           | | | |   |     | | |   |     |         |   |           |               |         +---|-+   |         |   |
 | | | | | | |           |         | |   |   |       |   | |                 |           | | | |   |     | | |   |     |         |   |           |               |         | | | |   |         |   |
 | | | | | | |     +---------------------|---|-------|-------------------------------------|-------|-------|-+   |     |         |   |           |               |         | | | |   |         |   |
 | | | | | | |     |     |         | |   |   |       |   | |                 |           | | | |   |     | |     |     |         |   |           |               |         | M | |   |         |   |
 +-+ | +---|-------------------------|---|---|-------------------------------------------|---|-------------------------------------------+       |           +-------+     | | | |   |         |   |
     |   | | |     |     |         | |   |   |       |   | |                 |           | | | |   |     | |     |     |         |   |   |       |           |   |   |     | | | |   |         |   |
   +---------+     |     |         | |   |   |       +-----------------------|-----------+ | | |   |     | |     |     |         |   |   |       |           |   |   |     | | | |   |         |   |
   | |   | |       |     |         | |   |   |           | |                 |             | | |   |     | |     |     |         |   |   |       |           |   |   |     | | | |   |         |   |
   | |   | |       |     |         | |   |   |           | |                 |             +-|-|---|-----|-+     |     |         |   |   |       |           |   |   |     | | | |   |         |   |
   | |   | |       |     |         | |   |   |           | |                 |               | |   |     |       |     |         |   |   |       |           |   |   |     | | | |   |         |   |
   | |   | |       +-----------------+   |   |           | |   +-----------------------------|-----|-----|-------|-----+         |   |   |       |           |   |   |     | | | |   |         |   |
   | |   | |             |         |     |   |           | |   |             |               | |   |     |       |               |   |   |       |           |   |   |     | | | |   |         |   |
 +-+ |   | |             |         |     |   |           +-----|-------------|---------------|-----------|---+   |               |   +---|-------|---------------|---+   +-|-|---+   |         |   |
 |   |   | |             |         |     |   |             |   |             |               | |   |     |   |   |               |       |       |           |   |       | | | |     |         |   |
 | +-|-----|-------------|---------|---------|-------------+   |             |               | +---|-----|---|-------------------+       |       |           +---|---------+ | |     |         |   |
 | | |   | |             |         |     |   |                 |             |               |     |     |   |   |                       |       |               |       |   | |     |         |   |
 | | |   +-|-----------------------|-+   +---|-----------+     |             |               +-----|-------------------------------------|-------|-----------------------|-----------+         |   |
 | | |     |             |         | |       |           |     |             |                     |     |   |   |                       |       |               |       |   | |               |   |
 | | |     | +---------+ |         | +---------------------------------------|--Y------------------|-----|---|-----------------------------------|-------------------+   |   +-----------------+   |
 | | |     | |         | |         |         |           |     |             |                     |     |   |   |                       |       |               |   |   |     |                   |
 | | |     | |         | |         |         |           +-----------------------------------------|---------+   |                       |       |               |   |   |     |                   |
 | | |     | |         | |         |         |                 |             |                     |     |       |                       |       |               |   |   |     |                   |
 | | |     +-----------|-|---------|---------|-------------+ +-+             +---------------------------------------------------------------------------------------+ +-+     |                   |
 | | |       |         | |         |         |             | |                                     |     |       |                       |       |               |     |       |                   |
 | | |       |         +-+         |         |             | +-+ +---------------------------------+     +-------------------------------|-------|---------------+     |       |                   |
 | | |       |                     |         |             |   | |                                               |                       |       |                     |       |                   |
 | | |       +-+                   +-----------------------|---|---------------------------------------------------------------------------------|---------------------|-------|-+                 |
 | | |         |                             |             |   | |                                               |                       |       |                     |       | |                 |
 +-+ +---------+                             +-------------+ P-+ +-----------------------------------------------+                       +-------+                     +-------+ +-----------------+
"""
struct Point {
    let x: Int
    let y: Int
    
    static let up = Point(x:0, y:1)
    static let down = Point(x:0, y:-1)
    static let left = Point(x:-1, y:0)
    static let right = Point(x:1, y:0)
    static let upRight = Point(x:1, y:1)
    static let downRight = Point(x:1, y:-1)
    static let upLeft = Point(x:-1, y:1)
    static let downLeft = Point(x:-1, y:-1)
    
    func adjacent() -> Set<Point> {
        let adjacents:[Point] = [.up, .down, .left, .right]
        
        return Set(adjacents.map({ self + $0 }))
    }
}

extension Point: Hashable {
    var hashValue: Int {
        return "\(x),\(y)".hashValue
    }
}

func ==(lhs: Point, rhs: Point) -> Bool {
    return lhs.x == rhs.x && lhs.y == rhs.y
}

func +(left: Point, right: Point) -> Point {
    return Point(x: left.x + right.x, y: left.y + right.y)
}



struct Map {
    let storage: [[Character]]
    
    init() {
       storage = input.components(separatedBy: "\n").map({ Array($0) })
    }
    
    func compute() -> String {
        var characters = [Character]()
        var stop = false
        var visited = Set<Point>()
        
        
        let start: Point = {
            let offset = storage[0].enumerated().first(where: { $0.element == "|"}  )!.offset
            
            return Point(x: offset, y: 0)
        }()
        
        var current = start
        var direction: Point = .up
        var steps = 1
        
        while !stop {
            current = current + direction
            visited.insert(current)
//            print("\(current)")
            
            let char = storage[current]
            steps += 1
            
            switch char {
            case "+":
                let validDirections = Set([.up, .down, .left, .right]).subtracting(Set([direction]))
                
                if let nextDirection = validDirections.filter({ (point) in
                    let test = current + point
                    return !visited.contains(test) && (storage[test] == "-" || storage[test] == "|")
                }).first {
                    direction = nextDirection
                } else {
                    stop = true
                }

            case "-","|":
                break
            case " ":
                stop = true
            default:
                characters.append(char)
//                print("\(characters)")
            }
        }
        steps
        return String(characters)
    }
}

extension Array where Element == Array<Character> {
    subscript(_ point: Point) -> Character {
        return contains(point) ? self[point.y][point.x] : " "
    }
    
    func contains(_ point: Point) -> Bool {
        return (0..<self.count).contains(point.y) && (0..<self[point.y].count).contains(point.x)
    }
}

let map = Map()

//let f = map.storage.reduce(0, { $0 + $1.count })
//
//f

map.compute()


//: [Next](@next)
